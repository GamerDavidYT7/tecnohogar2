<!DOCTYPE html>
{% load static %}
<html lang="es">
<head>
    <link rel="stylesheet" href="{% static 'css/common.css' %}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ producto.nombre }}</title>
    <style>
        /* Ejemplo: para pantallas menores a 600px */
@media (max-width: 600px) {
  body {
    font-size: 14px;
  }

  .container {
    padding: 10px;
  }

  nav {
    display: block;
  }
}


        body { font-family: Arial; padding: 20px; background: #f7f7f7; }
        .producto {
    display: flex;
    flex-wrap: wrap;      /* permite que los hijos bajen a la siguiente línea en pantallas pequeñas */
    gap: 20px;
    margin-bottom: 30px;
    align-items: flex-start; /* opcional: alinear al inicio */
}

.producto img {
    max-width: 100%;  /* ajusta al contenedor */
    height: auto;     /* mantiene proporción */
    border-radius: 10px;
    display: block;
    flex: 1 1 320px; /* ancho flexible: crece hasta 320px, se reduce si la pantalla es más pequeña */
}

.producto > div {
    flex: 1 1 300px; /* contenido textual también flexible */
}


        .resena { background: #f1f1f1; padding: 15px; margin: 10px 0; border-radius: 8px; }
        form textarea { width: 100%; height: 80px; }
        form input, form select { padding: 8px; }
        form button { padding: 10px 15px; background: #0078D7; color: white; border: none; border-radius: 5px; cursor: pointer; }

        .btn-volver {
            display: inline-block;
            text-decoration: none;
            background-color: #4CAF50;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.2s;
        }
        .btn-volver:hover {
            background-color: #45a049;
            transform: translateX(-3px);
        }

        .stock {
            font-size: 18px;
            font-weight: bold;
            padding: 8px;
            border-radius: 5px;
            display: inline-block;
            margin-top: 10px;
        }
        .stock-ok { color: green; }
        .stock-low { color: orange; }
        .stock-zero { color: red; }

        .btn-disabled {
            background: #888 !important;
            cursor: not-allowed !important;
            border: none;
        }

        .alert {
            background: #ffdddd;
            padding: 12px;
            border-left: 5px solid red;
            margin-bottom: 20px;
            border-radius: 5px;
            color: #a10000;
        }
    </style>
</head>
<body>

    <a class="btn-volver" href="{% url 'inicio' %}">⬅ Volver</a>

    <!-- MENSAJES DJANGO -->
    {% if messages %}
        {% for m in messages %}
            <div class="alert">{{ m }}</div>
        {% endfor %}
    {% endif %}

    <div class="producto">
        <img src="{{ producto.imagen_principal.url }}" alt="{{ producto.nombre }}">

        <div>
            <h1>{{ producto.nombre }}</h1>
            <p>{{ producto.descripcion }}</p>

            <h3>Precio: ${{ producto.precio }}</h3>

            <!-- STOCK -->
            {% if producto.stock > 10 %}
                <p class="stock stock-ok">Stock disponible: {{ producto.stock }}</p>
            {% elif producto.stock > 0 %}
                <p class="stock stock-low">¡Quedan pocas unidades! ({{ producto.stock }})</p>
            {% else %}
                <p class="stock stock-zero">Sin stock</p>
            {% endif %}

            <br>

            <!-- BOTÓN AGREGAR AL CARRITO -->
            {% if producto.stock > 0 %}
                <a href="{% url 'agregar_al_carrito' producto.id %}">
                    <button>Agregar al carrito</button>
                </a>
            {% else %}
                <button class="btn-disabled" disabled>No hay stock disponible</button>
            {% endif %}

        </div>
    </div>

    <hr>

    <h2>Reseñas</h2>

    {% for r in resenas %}
        <div class="resena">
            <strong>{{ r.usuario.username }} - {{ r.calificacion }}⭐</strong>
            <p>{{ r.contenido }}</p>
            <small>{{ r.fecha }}</small>
        </div>
    {% empty %}
        <p>No hay reseñas todavía.</p>
    {% endfor %}

    <hr>

    {% if user.is_authenticated %}

        <h3>Agregar reseña</h3>

        <form method="POST">
            {% csrf_token %}
            <label>Calificación:</label>
            <select name="calificacion">
                <option value="5">5 ⭐</option>
                <option value="4">4 ⭐</option>
                <option value="3">3 ⭐</option>
                <option value="2">2 ⭐</option>
                <option value="1">1 ⭐</option>
            </select>

            <br><br>

            <label>Comentario:</label><br>
            <textarea name="contenido"></textarea>

            <br><br>

            <button type="submit">Enviar reseña</button>
        </form>

    {% else %}
        <p><a href="{% url 'login' %}">Inicia sesión</a> para dejar una reseña.</p>
    {% endif %}

</body>
</html>


